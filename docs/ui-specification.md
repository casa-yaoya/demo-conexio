# UI仕様書

このドキュメントは、Naretore管理画面の各ページ・コンポーネントのUI仕様をまとめたものです。

---

## 1. ページ構成

### 1.1 ページ一覧

| パス | ページ名 | 説明 |
|-----|---------|------|
| `/` | インデックス | `/summary` へリダイレクト |
| `/summary` | サマリー | 統計データ・トレンドチャート・サマリーテーブル |
| `/ranking` | 個人レコード | プレイヤー別ランキングテーブル |
| `/logs` | ログ | プレイセッション詳細ログ |
| `/content-creation` | ロープレ構築 | ロールプレイ教材作成ツール（開発中） |
| `/data-import` | データインポート | CSVデータ読み込み（サイドバー非表示） |

---

## 2. 共通レイアウト（default.vue）

### 2.1 構造
```
┌──────────────────────────────────────────────────┐
│ AppSidebar (260px)                               │
│ ┌──────────────────────────────────────────────┐ │
│ │ Logo + "管理者ページ"                          │ │
│ ├──────────────────────────────────────────────┤ │
│ │ Navigation                                   │ │
│ │  ├ サマリー (i-lucide-bar-chart-3)           │ │
│ │  ├ 個人レコード (i-lucide-trophy)            │ │
│ │  ├ ログ (i-lucide-file-text)                 │ │
│ │  └ ロープレ構築 (i-lucide-pencil) [開発中]    │ │
│ ├──────────────────────────────────────────────┤ │
│ │ ログアウトボタン                               │ │
│ └──────────────────────────────────────────────┘ │
├──────────────────────────────────────────────────┤
│ Main Content Area                                │
│ ┌──────────────────────────────────────────────┐ │
│ │ AppHeader (64px)                             │ │
│ │  ├ ハンバーガーメニュー（モバイルのみ）        │ │
│ │  ├ ページタイトル                             │ │
│ │  ├ ユーザー情報                               │ │
│ │  └ ログアウトボタン                           │ │
│ ├──────────────────────────────────────────────┤ │
│ │ Page Content (slot)                          │ │
│ │                                              │ │
│ └──────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────┘
```

### 2.2 サイドバー（AppSidebar.vue）

#### ナビゲーションアイテム
| 項目 | パス | アイコン | バッジ |
|-----|------|---------|-------|
| サマリー | /summary | i-lucide-bar-chart-3 | - |
| 個人レコード | /ranking | i-lucide-trophy | - |
| ログ | /logs | i-lucide-file-text | - |
| ロープレ構築 | /content-creation | i-lucide-pencil | 開発中 |

#### スタイル
- アクティブ状態: グラデーション背景 + 左ボーダー3px（#0ea5e9）
- ホバー状態: 薄いグレー背景（#f1f5f9）+ テキスト色変更（#0ea5e9）

### 2.3 ヘッダー（AppHeader.vue）

#### 要素
- ハンバーガーメニュー（モバイルのみ表示）
- ページタイトル（動的）
- ユーザーアバター + 名前（"管理者"）
- ログアウトボタン

---

## 3. サマリーページ（/summary）

### 3.1 レイアウト
```
┌─────────────────────────────────────────────────┐
│ DataFilter (300px)  │ Content Area              │
│ ┌─────────────────┐ │ ┌─────────────────────────┐│
│ │ フィルターヘッダー│ │ │ 統計カード (4列グリッド) ││
│ ├─────────────────┤ │ │  ├ 総プレイ時間          ││
│ │ 期間絞り込み     │ │ │  ├ 総プレイ数            ││
│ │  ├ 開始日       │ │ │  ├ 総プレイヤー数        ││
│ │  └ 終了日       │ │ │  └ 総レッスン数          ││
│ ├─────────────────┤ │ ├─────────────────────────┤│
│ │ レッスン絞り込み │ │ │ トレンドチャート         ││
│ │  ├ カテゴリー   │ │ ├─────────────────────────┤│
│ │  ├ レベル       │ │ │ サマリーテーブル         ││
│ │  └ レッスン     │ │ │  ├ 表示単位切替          ││
│ ├─────────────────┤ │ │  ├ グラフ比較軸切替      ││
│ │ レベル絞り込み   │ │ │  ├ ダウンロードボタン    ││
│ ├─────────────────┤ │ │  ├ 列設定ボタン          ││
│ │ プレイヤー絞り込み│ │ │  └ データテーブル        ││
│ ├─────────────────┤ │ └─────────────────────────┘│
│ │ リセットボタン   │ │                           │
│ └─────────────────┘ │                           │
└─────────────────────────────────────────────────┘
```

### 3.2 統計カード

| 項目 | アイコン | 色 |
|-----|---------|-----|
| 総プレイ時間 | i-lucide-clock | #0ea5e9 (Sky) |
| 総プレイ数 | i-lucide-play-circle | #10b981 (Emerald) |
| 総プレイヤー数 | i-lucide-users | #8b5cf6 (Violet) |
| 総レッスン数 | i-lucide-book-open | #f59e0b (Amber) |

### 3.3 トレンドチャート

#### データセット
| ラベル | タイプ | 色 | Y軸 |
|-------|-------|-----|-----|
| ユニークプレイ人数 | 面グラフ | #8b5cf6 | 左 |
| クリア数 | 棒グラフ | #10b981 | 左 |
| プレイ数 | 棒グラフ | #3b82f6 | 左 |
| 平均スコア | 折れ線 | #f97316 | 右 |
| ベストスコア | 折れ線 | #ef4444 | 右 |

### 3.4 サマリーテーブル

#### 表示設定
| 設定 | オプション |
|-----|----------|
| 表示単位 | レッスン / レベル / カテゴリー |
| グラフ比較軸 | なし / アカウント / グループ / プレイヤー / コース / レベル / レッスン |

#### 列構成
| 列 | 表示/非表示 | デフォルト |
|---|-----------|----------|
| コース | 可 | 表示 |
| Lv. | 可 | 表示 |
| レッスン | 可 | 表示 |
| プレイ数 | 可 | 表示 |
| 平均 | 可 | 表示 |
| ベスト | 可 | 表示 |
| 累計時間 | 可 | 表示 |
| 平均時間 | 可 | 表示 |
| 最高点 | 可 | 表示 |

---

## 4. 個人レコードページ（/ranking）

### 4.1 レイアウト
```
┌─────────────────────────────────────────────────┐
│ DataFilter (300px)  │ Content Area              │
│                     │ ┌─────────────────────────┐│
│                     │ │ ランキングカード         ││
│                     │ │  ├ タイトル + アイコン   ││
│                     │ │  ├ サブタイトル          ││
│                     │ │  ├ ツールバー            ││
│                     │ │  │  ├ プレイヤー数バッジ ││
│                     │ │  │  ├ ダウンロードボタン ││
│                     │ │  │  └ 列設定ボタン       ││
│                     │ │  └ データテーブル        ││
│                     │ └─────────────────────────┘│
└─────────────────────────────────────────────────┘
```

### 4.2 ランキングテーブル

#### 列構成
| 列 | ソート可能 | デフォルト表示 |
|---|----------|--------------|
| 順位 | 不可 | 表示 |
| プレイヤー | 不可 | 表示 |
| 組織 | 可 | 非表示 |
| グループ | 可 | 非表示 |
| 総スコア | 可 | 表示 |
| プレイ数 | 可 | 表示 |
| クリア数 | 可 | 表示 |
| 平均スコア | 可 | 表示 |
| プレイ時間 | 可 | 表示 |
| 発話時間 | 可 | 表示 |

#### 順位ハイライト
| 順位 | 行クラス | セルクラス | 色 |
|-----|---------|----------|-----|
| 1位 | row-gold | rank-gold | ゴールド（#fef3c7 → #fde68a） |
| 2位 | row-silver | rank-silver | シルバー（#f1f5f9 → #e2e8f0） |
| 3位 | row-bronze | rank-bronze | ブロンズ（#fed7aa → #fdba74） |

---

## 5. ログページ（/logs）

### 5.1 レイアウト
```
┌─────────────────────────────────────────────────┐
│ DataFilter (300px)  │ Content Area              │
│                     │ ┌─────────────────────────┐│
│                     │ │ ログカード              ││
│                     │ │  ├ タイトル + アイコン   ││
│                     │ │  ├ サブタイトル          ││
│                     │ │  ├ ツールバー            ││
│                     │ │  │  ├ 件数バッジ         ││
│                     │ │  │  ├ ページ情報バッジ   ││
│                     │ │  │  ├ ダウンロードボタン ││
│                     │ │  │  └ 列設定ボタン       ││
│                     │ │  ├ データテーブル        ││
│                     │ │  └ ページネーション      ││
│                     │ └─────────────────────────┘│
└─────────────────────────────────────────────────┘
```

### 5.2 ログテーブル

#### 列構成
| 列 | ソート可能 | デフォルト表示 |
|---|----------|--------------|
| 日付 | 可 | 表示 |
| 組織 | 可 | 非表示 |
| アカウント | 可 | 非表示 |
| グループ | 可 | 非表示 |
| プレイヤー | 可 | 表示 |
| カテゴリー | 可 | 表示 |
| レベル | 可 | 表示 |
| レッスン | 可 | 表示 |
| スコア | 可 | 表示 |
| 発話時間 | 可 | 表示 |
| プレイ時間 | 可 | 表示 |

### 5.3 ページネーション

- 1ページあたり: 20件
- 表示: 「ページ X / Y」
- 操作: 前へ / 次へ ボタン

---

## 6. データフィルター（DataFilter.vue）

### 6.1 構造

#### セクション
| セクション | 折りたたみ | デフォルト状態 |
|----------|----------|--------------|
| 期間絞り込み | 不可 | 展開 |
| レッスンで絞り込み | 可 | 折りたたみ |
| レベルで絞り込み | 可 | 折りたたみ |
| プレイヤー絞り込み | 可 | 折りたたみ |

### 6.2 期間絞り込み
- 開始日: UInput type="date"
- 終了日: UInput type="date"
- デフォルト: 過去6ヶ月

### 6.3 レッスン絞り込み（階層構造）
```
├ カテゴリー（チェックボックス）
│  └ レベル（チェックボックス）
│     └ レッスン（チェックボックス）
```
- 親の選択状態: 全選択 / 部分選択（indeterminate）/ 未選択
- 選択件数をバッジで表示

### 6.4 レベル絞り込み
- Lv.1 〜 Lv.4 のチェックボックス
- デフォルト: 全選択

### 6.5 プレイヤー絞り込み（階層構造）
```
├ アカウント（チェックボックス）
│  └ グループ（チェックボックス）
│     └ プレイヤー（チェックボックス）
```

### 6.6 リセットボタン
- 全フィルターを初期状態に戻す
- アイコン: i-lucide-rotate-ccw

---

## 7. ロープレ構築ページ（/content-creation）

### 7.1 レイアウト（3カラムグリッド）
```
┌───────────────────────────────────────────────────────┐
│ 操作コンポーネント (450px) │ プレイコンポーネント      │
│ ┌───────────────────────┐ │ ┌───────────────────────┐ │
│ │ コース選択            │ │ │ レッスン選択           │ │
│ ├───────────────────────┤ │ ├───────────────────────┤ │
│ │ タブ: チャット/コース/ファイル│ │ │ モード + ビデオ + 設定  │ │
│ │                       │ │ └───────────────────────┘ │
│ │ [タブコンテンツ]       │ ├───────────────────────────┤
│ │                       │ │ 設計コンポーネント         │
│ │                       │ │ ┌───────────────────────┐ │
│ │                       │ │ │ テストエリア開閉ボタン │ │
│ │                       │ │ ├───────────────────────┤ │
│ │                       │ │ │ タブ: 設計/流れ/設計書  │ │
│ │                       │ │ │                       │ │
│ │                       │ │ │ [タブコンテンツ]       │ │
│ └───────────────────────┘ │ └───────────────────────┘ │
└───────────────────────────────────────────────────────┘
```

### 7.2 操作コンポーネントタブ

| タブ | 内容 |
|-----|------|
| チャット | AIチャットインターフェース |
| コース | コースツリー構造 |
| ファイル | アップロード済みファイル一覧 |

### 7.3 モード選択
| モード | 説明 |
|-------|------|
| 台本モード | 台本読み上げ |
| お手本モード | AI実演 |
| 確認モード | 理解度確認 |
| 実戦モード | 実践練習 |

### 7.4 設計コンポーネントタブ

| タブ | 内容 |
|-----|------|
| ロープレ設計 | RoleplayDesignForm |
| 会話の流れ | スクリプト一覧 |
| 設計書 | システムプロンプト設定 |

---

## 8. Composables

### 8.1 useDemoData

データ管理用composable。

#### 主要メソッド
| メソッド | 説明 |
|---------|------|
| loadDemoData() | デモCSVデータ読み込み |
| loadFromCSVFile(file) | CSVファイル読み込み |
| getFilterOptions() | フィルター選択肢取得 |
| getFilteredSummaryData(unit, filters) | サマリーデータ取得 |
| getFilteredRankingData(filters) | ランキングデータ取得 |
| getFilteredLogData(page, size, filters) | ログデータ取得 |
| getFilteredAggregatedStats(filters) | 集計統計取得 |
| getComparisonTrendData(axis, filters) | トレンドデータ取得 |

### 8.2 useTableSort

テーブルソート機能用composable。

#### 戻り値
| プロパティ/メソッド | 説明 |
|------------------|------|
| sortState | ソート状態 { column, direction } |
| sortedData | ソート済みデータ |
| toggleSort(column) | ソート切替 |
| getSortIcon(column) | ソートアイコン取得（▲/▼/-） |
| isSortedColumn(column) | ソート中判定 |

### 8.3 useRealtimeAPI

OpenAI Realtime API連携用composable。

#### 戻り値
| プロパティ/メソッド | 説明 |
|------------------|------|
| isConnected | 接続状態 |
| isPlaying | 再生中状態 |
| isRecording | 録音中状態 |
| isSpeaking | 発話中状態 |
| connectionStatus | 接続ステータステキスト |
| toggleRoleplay(config) | ロープレ開始/停止 |
| toggleRecording() | 録音開始/停止 |

---

## 9. フォーマット関数

### 9.1 時間フォーマット

```typescript
// テーブル用（短縮形）
formatTime(seconds: number): string
// 例: 3661 → "1時1分1秒"

// 統計カード用（長形式）
formatTimeLong(seconds: number): string
// 例: 3661 → "1時間1分1秒"
```

### 9.2 日時フォーマット

```typescript
formatDateTime(dateString: string | Date): string
// 例: "2024-11-26T10:30:00" → "2024/11/26 10:30"
```

---

## 10. CSVダウンロード

### 10.1 仕様
- エンコーディング: UTF-8 (BOM付き)
- 区切り文字: カンマ
- 引用符: ダブルクォート

### 10.2 ファイル名
| ページ | ファイル名パターン |
|-------|------------------|
| サマリー | summary_YYYY-MM-DD.csv |
| ランキング | personal_record_YYYY-MM-DD.csv |
| ログ | log_YYYY-MM-DD.csv |

---

## 11. 状態管理

### 11.1 グローバル状態（useState）

| キー | 型 | 説明 |
|-----|---|------|
| isSidebarOpen | boolean | サイドバー開閉状態（モバイル用） |

### 11.2 ページローカル状態

#### サマリーページ
| 状態 | 型 | デフォルト |
|-----|---|----------|
| summaryDisplayUnit | 'lesson' \| 'level' \| 'category' | 'lesson' |
| chartCompareAxis | string | 'none' |
| currentFilters | FilterState | - |
| isFilterCollapsed | boolean | false |
| visibleColumns | Record<string, boolean> | 全て表示 |

#### ランキングページ
| 状態 | 型 | デフォルト |
|-----|---|----------|
| sortState | { column, direction } | { totalScore, desc } |
| currentFilters | FilterState | - |
| visibleColumns | Record<string, boolean> | 組織・グループ以外表示 |

#### ログページ
| 状態 | 型 | デフォルト |
|-----|---|----------|
| currentPage | number | 1 |
| pageSize | number | 20 |
| sortState | { column, direction } | - |
| currentFilters | FilterState | - |
| visibleColumns | Record<string, boolean> | 組織・アカウント・グループ以外表示 |

---

## 12. エラー処理

### 12.1 データ読み込みエラー
- コンソールにエラーログ出力
- ユーザーへの通知: 「デモデータの読み込みに失敗しました」

### 12.2 データ空状態
- テーブル: 「データがありません」メッセージ表示
- colspan: 表示列数に合わせて動的設定

---

## 付録A: 型定義

### FilterState
```typescript
interface FilterState {
  lessons?: string[]
  levels?: string[]
  players?: string[]
  dateFrom: Date | null
  dateTo: Date | null
}
```

### FilterOptions
```typescript
interface FilterOptions {
  categories: string[]
  levels: Record<string, string[]>
  lessons: Record<string, string[]>
  players: string[]
  accounts: string[]
  groups: string[]
  accountGroups: Record<string, string[]>
  groupPlayers: Record<string, string[]>
}
```

### FileData
```typescript
interface FileData {
  name: string
  uploadDate: string
  dataType: string
  extractedText?: string
  summary?: string
}
```
